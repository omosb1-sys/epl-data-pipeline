# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""
ğŸ“Š Kë¦¬ê·¸ 2024 ì‹œì¦Œ ê³ ê¸‰ ë¶„ì„ - Part 2
=============================================
ê¸°ì¡´ ë…¸íŠ¸ë¶ì˜ EDA ì´í›„ ë¶„ì„ ì½”ë“œ (í†µê³„ë¶„ì„ â†’ ë¨¸ì‹ ëŸ¬ë‹ â†’ ì¸ì‚¬ì´íŠ¸ ì¶”ì¶œ)

ğŸ¯ ë¶„ì„ êµ¬ì„±:
  [1] ë°ì´í„° ë¡œë“œ ë° íŒŒìƒì»¬ëŸ¼ ìƒì„± (ë³µìŠµ)
  [2] ê³ ê¸‰ í†µê³„ë¶„ì„ (ê°€ì„¤ê²€ì •, ANOVA)
  [3] ìƒê´€ê´€ê³„ ë¶„ì„ (Correlation Matrix, Heatmap)
  [4] ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ë§ (ë¡œì§€ìŠ¤í‹± íšŒê·€, ëœë¤í¬ë ˆìŠ¤íŠ¸)
  [5] ì¸ì‚¬ì´íŠ¸ ì¶”ì¶œ (íŒ€ ì„±ê³¼, ìŠ¤íƒ€ì¼ ë¶„ë¥˜)
  [6] ì‹œê°í™” ë° ë³´ê³ ì„œ ìƒì„±

ì‘ì„±ì: Claude (Senior Data Analyst)
ë‚œì´ë„: â­â­â­ (ì´ˆë³´ì-ì¤‘ê¸‰ì)
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""

# ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°(import)
import pandas as pd
# ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°(import)
import numpy as np
# ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°(import)
import matplotlib.pyplot as plt
# ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°(import)
import seaborn as sns
# í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ì„ íƒí•´ì„œ ë¶ˆëŸ¬ì˜¤ê¸°(from import)
from scipy import stats
# í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ì„ íƒí•´ì„œ ë¶ˆëŸ¬ì˜¤ê¸°(from import)
from sklearn.preprocessing import StandardScaler, LabelEncoder
# í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ì„ íƒí•´ì„œ ë¶ˆëŸ¬ì˜¤ê¸°(from import)
from sklearn.linear_model import LogisticRegression
# í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ì„ íƒí•´ì„œ ë¶ˆëŸ¬ì˜¤ê¸°(from import)
from sklearn.model_selection import train_test_split, cross_val_score
# í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ì„ íƒí•´ì„œ ë¶ˆëŸ¬ì˜¤ê¸°(from import)
from sklearn.metrics import (classification_report, accuracy_score, 
                            # ROC/AUCë¡œ í™•ë¥  ì˜ˆì¸¡ í’ˆì§ˆì„ í‰ê°€
                            roc_auc_score, roc_curve, confusion_matrix)
# í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ì„ íƒí•´ì„œ ë¶ˆëŸ¬ì˜¤ê¸°(from import)
from sklearn.ensemble import RandomForestClassifier
# ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°(import)
import warnings
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
warnings.filterwarnings("ignore")

# ============================================================
# ğŸ”§ ê¸°ë³¸ ì„¤ì •
# ============================================================
# ì‹œê°í™”(ê·¸ë˜í”„) ê´€ë ¨ ì„¤ì •/ê·¸ë¦¬ê¸°/ì €ì¥
plt.rcParams['font.family'] = 'AppleGothic'
# ì‹œê°í™”(ê·¸ë˜í”„) ê´€ë ¨ ì„¤ì •/ê·¸ë¦¬ê¸°/ì €ì¥
plt.rcParams['axes.unicode_minus'] = False
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
pd.set_option('display.max_columns', None)
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
pd.set_option('display.width', None)

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n" + "="*80)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("ğŸ¯ Kë¦¬ê·¸ 2024 ì‹œì¦Œ ê³ ê¸‰ ë¶„ì„ - Part 2 ì‹œì‘!")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("   (í†µê³„ë¶„ì„, ìƒê´€ê´€ê³„, ë¨¸ì‹ ëŸ¬ë‹, ì¸ì‚¬ì´íŠ¸ ì¶”ì¶œ)")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("="*80 + "\n")


# ============================================================
# ğŸ“‚ [1] ë°ì´í„° ë¡œë“œ ë° íŒŒìƒì»¬ëŸ¼ ìƒì„±
# ============================================================
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("[1ë‹¨ê³„] ë°ì´í„° ë¡œë“œ ë° íŒŒìƒì»¬ëŸ¼ ìƒì„±")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*80)

# ì—ëŸ¬ê°€ ë‚  ìˆ˜ ìˆëŠ” êµ¬ê°„ì„ tryë¡œ ê°ì‹¸ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
try:
    # CSV íŒŒì¼ì„ ì½ì–´ì„œ DataFrameìœ¼ë¡œ ë¡œë“œ
    raw_data = pd.read_csv('data/raw/raw_data.csv', encoding='utf-8')
    # CSV íŒŒì¼ì„ ì½ì–´ì„œ DataFrameìœ¼ë¡œ ë¡œë“œ
    match_info = pd.read_csv('data/raw/match_info.csv', encoding='utf-8')
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"âœ“ raw_data ë¡œë“œ ì„±ê³µ: {raw_data.shape}")
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"âœ“ match_info ë¡œë“œ ì„±ê³µ: {match_info.shape}")
# ì—ëŸ¬ê°€ ë‚¬ì„ ë•Œ ì‹¤í–‰í•  ì²˜ë¦¬ ë¡œì§
except FileNotFoundError:
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print("âŒ ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    exit(1)

# ë°ì´í„° íƒ€ì… ë³€í™˜
# ë‚ ì§œ ë¬¸ìì—´ì„ datetime íƒ€ì…ìœ¼ë¡œ ë³€í™˜(ì •ë ¬/í•„í„°ì— ìœ ë¦¬)
match_info['game_date'] = pd.to_datetime(match_info['game_date'])

# ê²°ì¸¡ì¹˜ ì²˜ë¦¬
# ê²°ì¸¡ì¹˜(NaN)ë¥¼ ì±„ì›Œ ê³„ì‚° ì˜¤ë¥˜ë¥¼ ë°©ì§€
raw_data['result_name'] = raw_data['result_name'].fillna('Unknown')

# ë°ì´í„° ë³‘í•©
# ê³µí†µ í‚¤ë¡œ í…Œì´ë¸”ì„ í•©ì¹˜ëŠ” ì¡°ì¸(merge) ìˆ˜í–‰
df = raw_data.merge(match_info, on='game_id', how='left')
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"âœ“ ë°ì´í„° ë³‘í•© ì™„ë£Œ: {df.shape}")

# ê²½ê¸°ë³„-íŒ€ë³„ í†µê³„ ë°ì´í„° ìƒì„± (Feature Engineering)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[1-2] ê²½ê¸°ë³„-íŒ€ë³„ í†µê³„ ë°ì´í„° ìƒì„±")

# ê·¸ë£¹í™”(groupby)ë¡œ ë¬¶ì–´ì„œ ìš”ì•½ í†µê³„ë¥¼ ë§Œë“¤ ì¤€ë¹„
game_team_stats = df.groupby(['game_id', 'team_name_ko']).apply(
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    lambda x: pd.Series({
        # ê¸°ë³¸ íŒ¨ìŠ¤ ì§€í‘œ
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'total_passes': len(x[x['type_name'].isin(['Pass', 'Pass_Freekick', 'Cross'])]),
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'pass_success_rate': (x['result_name'] == 'Successful').sum() / 
                             # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
                             max(len(x[x['type_name'].isin(['Pass', 'Pass_Freekick', 'Cross'])]), 1) * 100,
        # ìŠˆíŒ… ì§€í‘œ
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'total_shots': len(x[x['type_name'].isin(['Shot', 'Shot_Freekick', 'Penalty'])]),
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'goals': len(x[x['type_name'] == 'Goal']),
        # ìˆ˜ë¹„ ì§€í‘œ
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'tackles': len(x[x['type_name'] == 'Tackle']),
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'interceptions': len(x[x['type_name'] == 'Interception']),
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'fouls': len(x[x['type_name'] == 'Foul']),
        # ê³µê²© ì§€í‘œ
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'attack_zone_actions': len(x[x['start_x'] > 70]),
        # ë°ì´í„° íƒ€ì…ì„ ë³€í™˜í•˜ì—¬ ë¹„êµ/ê³„ì‚° ê°€ëŠ¥í•˜ê²Œ ë§Œë“¦
        'take_ons': x['type_name'].astype(str).str.lower().str.contains('take').sum(),
        # ì¶”ê°€ ì§€í‘œ
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'crosses': len(x[x['type_name'] == 'Cross']),
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        'corners': len(x[x['type_name'] == 'Pass_Corner']),
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    })
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
).reset_index()

# ê²½ê¸° ì •ë³´ merge (íš¨ìœ¨ì ì¸ ë°©ë²•)
# ê³µí†µ í‚¤ë¡œ í…Œì´ë¸”ì„ í•©ì¹˜ëŠ” ì¡°ì¸(merge) ìˆ˜í–‰
game_team_stats = game_team_stats.merge(
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    match_info[['game_id', 'home_score', 'away_score', 'home_team_id', 'away_team_id', 'game_date']], 
    # ë³€ìˆ˜ `on`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
    on='game_id',
    # ë³€ìˆ˜ `how`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
    how='left'
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
)

# team_id ì¶”ê°€
# ê·¸ë£¹í™”(groupby)ë¡œ ë¬¶ì–´ì„œ ìš”ì•½ í†µê³„ë¥¼ ë§Œë“¤ ì¤€ë¹„
team_id_map = df.groupby(['game_id', 'team_name_ko'])['team_id'].first().reset_index()
# ê³µí†µ í‚¤ë¡œ í…Œì´ë¸”ì„ í•©ì¹˜ëŠ” ì¡°ì¸(merge) ìˆ˜í–‰
game_team_stats = game_team_stats.merge(team_id_map, on=['game_id', 'team_name_ko'], how='left')

# í™ˆ/ì–´ì›¨ì´ êµ¬ë¶„
# ë°ì´í„° íƒ€ì…ì„ ë³€í™˜í•˜ì—¬ ë¹„êµ/ê³„ì‚° ê°€ëŠ¥í•˜ê²Œ ë§Œë“¦
game_team_stats['is_home'] = (game_team_stats['team_id'] == game_team_stats['home_team_id']).astype(int)

# ìŠ¹ë¦¬/ë¬´ìŠ¹ë¶€ ì—¬ë¶€ ê³„ì‚°
# ì¬ì‚¬ìš©ì„ ìœ„í•´ í•¨ìˆ˜ë¥¼ ì •ì˜(ë°˜ë³µë˜ëŠ” ë¡œì§ì„ ë¬¶ê¸°)
def calculate_match_result(row):
    # (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
    """ê²½ê¸° ê²°ê³¼ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜"""
    if row['team_id'] == row['home_team_id']:
        our_score = row['home_score']
        their_score = row['away_score']
    else:
        our_score = row['away_score']
        their_score = row['home_score']
    
    if our_score > their_score:
        return 1  # ìŠ¹ë¦¬
    elif our_score == their_score:
        return 1  # ë¬´ìŠ¹ë¶€ (ì ìˆ˜ íšë“)
    else:
        return 0  # íŒ¨ë°°

game_team_stats['win_or_draw'] = game_team_stats.apply(calculate_match_result, axis=1)

# ìƒëŒ€íŒ€ ì‹¤ì  ì •ë³´
def get_goals_against(row):
    # (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
    """ìƒëŒ€íŒ€ ë“ì (=ë‚´ ì‹¤ì ) ê³„ì‚°"""
    # ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ë¶„ê¸°(ì¡°ê±´ë¬¸)
    if row['team_id'] == row['home_team_id']:
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        return row['away_score']
    # ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ë¶„ê¸°(ì¡°ê±´ë¬¸)
    else:
        # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
        return row['home_score']

# í–‰/ê·¸ë£¹ ë‹¨ìœ„ë¡œ í•¨ìˆ˜ë¥¼ ì ìš©(apply)í•´ ê°’ì„ ê³„ì‚°
game_team_stats['goals_against'] = game_team_stats.apply(get_goals_against, axis=1)

# ë“ì‹¤ì°¨ ê³„ì‚°
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
game_team_stats['goal_diff'] = game_team_stats['goals'] - game_team_stats['goals_against']

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"âœ“ í†µê³„ ë°ì´í„° ìƒì„± ì™„ë£Œ: {game_team_stats.shape}")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"âœ“ ìƒì„±ëœ ì»¬ëŸ¼: {list(game_team_stats.columns)}")


# ============================================================
# ğŸ“Š [2] ê³ ê¸‰ í†µê³„ë¶„ì„ (Statistical Analysis)
# ============================================================
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n" + "="*80)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("[2ë‹¨ê³„] ê³ ê¸‰ í†µê³„ë¶„ì„")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("="*80)

# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""
ğŸ’¡ í†µê³„ë¶„ì„ì˜ ëª©ì :
   "ë°ì´í„°ì—ì„œ ë°œê²¬í•œ ì°¨ì´ê°€ ì •ë§ ì˜ë¯¸ìˆëŠ” ì°¨ì´ì¸ê°€?"
   ë¥¼ ìˆ˜í•™ì ìœ¼ë¡œ ì¦ëª…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ğŸ“Œ p-value í•´ì„:
   - p-value < 0.05: í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•¨ âœ“ (95% í™•ì‹ )
   - p-value â‰¥ 0.05: ìœ ì˜ë¯¸í•˜ì§€ ì•ŠìŒ âœ—
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""

# [2-1] í™ˆíŒ€ vs ì–´ì›¨ì´íŒ€ ë“ì  ì°¨ì´ (ë…ë¦½í‘œë³¸ t-ê²€ì •)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[2-1] ê°€ì„¤ê²€ì •: í™ˆíŒ€ vs ì–´ì›¨ì´íŒ€ ë“ì  ì°¨ì´")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# ë³€ìˆ˜ `home_goals`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
home_goals = game_team_stats[game_team_stats['is_home'] == 1]['goals']
# ë³€ìˆ˜ `away_goals`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
away_goals = game_team_stats[game_team_stats['is_home'] == 0]['goals']

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"í™ˆíŒ€ í‰ê·  ë“ì : {home_goals.mean():.2f}ê³¨ (Â±{home_goals.std():.2f})")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"ì–´ì›¨ì´íŒ€ í‰ê·  ë“ì : {away_goals.mean():.2f}ê³¨ (Â±{away_goals.std():.2f})")

# ì •ê·œì„± ê²€ì • (Shapiro-Wilk)
# í†µê³„ ê²€ì •/ì§€í‘œ ê³„ì‚° ìˆ˜í–‰
_, p_shapiro_home = stats.shapiro(home_goals[:50])  # ìƒ˜í”Œ ì œí•œ
# í†µê³„ ê²€ì •/ì§€í‘œ ê³„ì‚° ìˆ˜í–‰
_, p_shapiro_away = stats.shapiro(away_goals[:50])

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\nğŸ“‹ ì •ê·œì„± ê²€ì • (Shapiro-Wilk):")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  í™ˆíŒ€: p={p_shapiro_home:.4f} {'âœ“ ì •ê·œë¶„í¬' if p_shapiro_home > 0.05 else 'âœ— ë¹„ì •ê·œë¶„í¬'}")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  ì–´ì›¨ì´íŒ€: p={p_shapiro_away:.4f} {'âœ“ ì •ê·œë¶„í¬' if p_shapiro_away > 0.05 else 'âœ— ë¹„ì •ê·œë¶„í¬'}")

# ë“±ë¶„ì‚° ê²€ì • (Levene)
# í†µê³„ ê²€ì •/ì§€í‘œ ê³„ì‚° ìˆ˜í–‰
_, p_levene = stats.levene(home_goals, away_goals)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\nğŸ“‹ ë“±ë¶„ì‚° ê²€ì • (Levene): p={p_levene:.4f} {'âœ“ ë¶„ì‚° ë™ì¼' if p_levene > 0.05 else 'âœ— ë¶„ì‚° ë‹¤ë¦„'}")

# ë…ë¦½í‘œë³¸ t-ê²€ì •
# í†µê³„ ê²€ì •/ì§€í‘œ ê³„ì‚° ìˆ˜í–‰
t_stat, p_ttest = stats.ttest_ind(home_goals, away_goals)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\nâ­ ë…ë¦½í‘œë³¸ t-ê²€ì • ê²°ê³¼:")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  t-í†µê³„ëŸ‰: {t_stat:.4f}")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  p-value: {p_ttest:.4f}")

# ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ë¶„ê¸°(ì¡°ê±´ë¬¸)
if p_ttest < 0.05:
    # ë³€ìˆ˜ `home_advantage`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
    home_advantage = (home_goals.mean() - away_goals.mean()) / away_goals.mean() * 100
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"  âœ“ ê²°ë¡ : í™ˆíŒ€ê³¼ ì–´ì›¨ì´íŒ€ì˜ ë“ì ì— í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤!")
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"  ğŸ“ˆ í™ˆ ì´ì : {home_advantage:.1f}%")
# ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ë¶„ê¸°(ì¡°ê±´ë¬¸)
else:
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"  âœ— ê²°ë¡ : í™ˆíŒ€ê³¼ ì–´ì›¨ì´íŒ€ì˜ ë“ì ì— ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤.")


# (t-ê²€ì •ê³¼ ì‹œê°í™”)ë¶„ì„í•˜ê³  ì‹¶ì€ ì§€í‘œë“¤ ë¦¬ìŠ¤íŠ¸
analysis_features = ['attack_zone_actions', 'pass_success_rate']

print("ğŸ” [í™ˆ ì´ì  ì‹¬ì¸µ ë¶„ì„] ê³µê²© ì§„ì… vs íŒ¨ìŠ¤ í’ˆì§ˆ")
print("="*60)

for feature in analysis_features:
    # í™ˆíŒ€ê³¼ ì–´ì›¨ì´íŒ€ ë°ì´í„° ë¶„ë¦¬
    home_data = game_team_stats[game_team_stats['is_home'] == 1][feature]
    away_data = game_team_stats[game_team_stats['is_home'] == 0][feature]
    
    # t-ê²€ì • ìˆ˜í–‰
    t_stat, p_val = stats.ttest_ind(home_data, away_data)
    
    print(f"\nğŸ“Š ì§€í‘œ: {feature}")
    print(f"  - í™ˆíŒ€ í‰ê·   : {home_data.mean():.2f}")
    print(f"  - ì–´ì›¨ì´ í‰ê· : {away_data.mean():.2f}")
    print(f"  - p-value    : {p_val:.4f}")
    
    if p_val < 0.05:
        diff_pct = (home_data.mean() - away_data.mean()) / away_data.mean() * 100
        print(f"  ğŸ‘‰ ê²°ë¡ : í†µê²Œì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŒ! (í™ˆì´ {diff_pct:.1f}% ë” ë†’ìŒ)")
    else:
        print(f"  ğŸ‘‰ ê²°ë¡ : ìš°ì—°í•œ ì°¨ì´ì¼ ë¿, í™ˆ/ì–´ì›¨ì´ ì˜í–¥ì´ ê±°ì˜ ì—†ìŒ")

# --- ì‹œê°í™”: ë‘ ì§€í‘œì˜ í™ˆ/ì–´ì›¨ì´ ì°¨ì´ ë¹„êµ ---
fig, axes = plt.subplots(1, 2, figsize=(15, 6))

for i, feature in enumerate(analysis_features):
    sns.boxplot(x='is_home', y=feature, data=game_team_stats, ax=axes[i], palette='Set2')
    axes[i].set_title(f'í™ˆ/ì–´ì›¨ì´ë³„ {feature} ë¹„êµ', fontsize=14)
    axes[i].set_xticklabels(['ì–´ì›¨ì´(0)', 'í™ˆ(1)'])
    axes[i].set_xlabel('ì¥ì†Œ')

plt.tight_layout()
plt.show()

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from scipy import stats

# 1. [ì†ë„ ê°œì„ ] í•„ìš”í•œ ë°ì´í„°ë§Œ ë¯¸ë¦¬ í•„í„°ë§í•´ì„œ ìš”ì•½í•©ë‹ˆë‹¤.
# (ì „ì²´ ë°ì´í„°ë¥¼ í›‘ì§€ ì•Šê³  'ê³µê²©ì§„ì…'ê³¼ 'ìŠˆíŒ…' ì¡°ê±´ë§Œ ë¨¼ì € ë½‘ìŠµë‹ˆë‹¤)
attack_events = df[df['start_x'] > 70].groupby(['game_id', 'team_name_ko']).size().rename('attack_zone_actions')
shot_events = df[df['type_name'].str.contains('Shot', case=False, na=False)].groupby(['game_id', 'team_name_ko']).size().rename('total_shots')

# ë‘ ì§€í‘œë¥¼ í•©ì¹©ë‹ˆë‹¤.
game_stats_summary = pd.concat([attack_events, shot_events], axis=1).fillna(0)

# 2. íŒ€ë³„ í‰ê·  ê³„ì‚°
team_analysis = game_stats_summary.groupby('team_name_ko').mean()

# 3. ìƒê´€ê³„ìˆ˜ ê³„ì‚°
corr, p_val = stats.pearsonr(team_analysis['attack_zone_actions'], team_analysis['total_shots'])

# 4. ì‹œê°í™” (í•œê¸€ ì„¤ì • ì¬í™•ì¸)
plt.rcParams['font.family'] = 'AppleGothic' # Macìš©
plt.rcParams['axes.unicode_minus'] = False

plt.figure(figsize=(10, 8))
# regplotì—ì„œ ci=Noneìœ¼ë¡œ ì£¼ë©´ ê³„ì‚° ì†ë„ê°€ ë” ë¹¨ë¼ì§‘ë‹ˆë‹¤.
sns.regplot(x='attack_zone_actions', y='total_shots', data=team_analysis, 
            scatter_kws={'s': 150, 'alpha': 0.7, 'color': 'teal'}, 
            line_kws={'color': 'red', 'lw': 2})

# [í•µì‹¬] ëª¨ë“  íŒ€ ì´ë¦„ì„ ê¹¨ì§ ì—†ì´ í‘œì‹œ (i, team ë£¨í”„)
for i, team in enumerate(team_analysis.index):
    plt.text(team_analysis['attack_zone_actions'][i], 
             team_analysis['total_shots'][i] + 0.1, # ì  ë°”ë¡œ ìœ„ì— í‘œì‹œë˜ê²Œ ì¡°ì •
             team, fontsize=11, fontweight='bold', ha='center')

plt.title(f'ê³µê²©ì§„ì… vs ìŠˆíŒ… ìƒê´€ê´€ê³„ (ìƒê´€ê³„ìˆ˜: {corr:.2f})', fontsize=16, pad=20)
plt.xlabel('í‰ê·  ê³µê²© ì§€ì—­ ì§„ì… ë¹ˆë„ (Attack Zone Actions)', fontsize=12)
plt.ylabel('í‰ê·  ìŠˆíŒ… íšŸìˆ˜ (Total Shots)', fontsize=12)
plt.grid(True, linestyle='--', alpha=0.5)
plt.tight_layout()
plt.show()



# [2-2] ì¼ì›ë¶„ì‚°ë¶„ì„ (ANOVA) - íŒ€ë³„ í‰ê·  ë“ì  ë¹„êµ
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[2-2] ì¼ì›ë¶„ì‚°ë¶„ì„ (ANOVA): íŒ€ë³„ í‰ê·  ë“ì  ë¹„êµ")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""
ğŸ’¡ ANOVAë€?
   ì—¬ëŸ¬ ê·¸ë£¹(íŒ€)ì˜ í‰ê· ì„ ë¹„êµí•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
   "ëª¨ë“  íŒ€ì˜ í‰ê·  ë“ì ì´ ê°™ì€ê°€?" ë¥¼ ê²€ì •í•©ë‹ˆë‹¤.
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""

# ê·¸ë£¹í™”(groupby)ë¡œ ë¬¶ì–´ì„œ ìš”ì•½ í†µê³„ë¥¼ ë§Œë“¤ ì¤€ë¹„
team_goals_list = [group['goals'].values for name, group in game_team_stats.groupby('team_name_ko')]
# í†µê³„ ê²€ì •/ì§€í‘œ ê³„ì‚° ìˆ˜í–‰
f_stat, p_anova = stats.f_oneway(*team_goals_list)

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"F-í†µê³„ëŸ‰: {f_stat:.4f}")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"p-value: {p_anova:.4f}")

# ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ë¶„ê¸°(ì¡°ê±´ë¬¸)
if p_anova < 0.05:
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"âœ“ ê²°ë¡ : íŒ€ë³„ë¡œ í‰ê·  ë“ì ì— í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤!")
# ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ë¶„ê¸°(ì¡°ê±´ë¬¸)
else:
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"âœ— ê²°ë¡ : íŒ€ë³„ í‰ê·  ë“ì ì— ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤.")

 """
 import pandas as pd
from scipy import stats

# [ì¤€ë¹„ë‹¨ê³„] ì‹¤ì (goals_against) ì»¬ëŸ¼ì´ ì—†ë‹¤ë©´ ì—¬ê¸°ì„œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
if 'goals_against' not in game_team_stats.columns:
    def get_goals_against(row):
        if row['team_id'] == row['home_team_id']:
            return row['away_score']
        else:
            return row['home_score']
    game_team_stats['goals_against'] = game_team_stats.apply(get_goals_against, axis=1)

# ---------------------------------------------------------
# 1. íŒ¨ìŠ¤ ì„±ê³µë¥ (pass_success_rate) íŒ€ë³„ ë¹„êµ
# ---------------------------------------------------------
print("ğŸ“Š [ë¶„ì„ 1] íŒ€ë³„ íŒ¨ìŠ¤ ì„±ê³µë¥  ANOVA")
print("-" * 50)

# íŒ€ë³„ íŒ¨ìŠ¤ ì„±ê³µë¥  ë¦¬ìŠ¤íŠ¸ ìƒì„±
pass_rate_list = [group['pass_success_rate'].values for name, group in game_team_stats.groupby('team_name_ko')]
f_stat_pass, p_val_pass = stats.f_oneway(*pass_rate_list)

print(f"F-í†µê³„ëŸ‰: {f_stat_pass:.4f}")
print(f"p-value: {p_val_pass:.4f}")

if p_val_pass < 0.05:
    print("âœ… ê²°ë¡ : íŒ€ë³„ íŒ¨ìŠ¤ ì„±ê³µë¥ ì— í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤! (ë¹Œë“œì—… ì‹¤ë ¥ì´ ë‹¤ë¦„)")
else:
    print("âŒ ê²°ë¡ : íŒ€ë³„ íŒ¨ìŠ¤ ì„±ê³µë¥ ì´ ë‹¤ ë¹„ìŠ·ë¹„ìŠ·í•©ë‹ˆë‹¤.")

# ---------------------------------------------------------
# 2. ì‹¤ì (goals_against) íŒ€ë³„ ë¹„êµ
# ---------------------------------------------------------
print("\nğŸ›¡ï¸ [ë¶„ì„ 2] íŒ€ë³„ ì‹¤ì (ìˆ˜ë¹„ë ¥) ANOVA")
print("-" * 50)

# íŒ€ë³„ ì‹¤ì  ë¦¬ìŠ¤íŠ¸ ìƒì„±
goals_against_list = [group['goals_against'].values for name, group in game_team_stats.groupby('team_name_ko')]
f_stat_def, p_val_def = stats.f_oneway(*goals_against_list)

print(f"F-í†µê³„ëŸ‰: {f_stat_def:.4f}")
print(f"p-value: {p_val_def:.4f}")

if p_val_def < 0.05:
    print("âœ… ê²°ë¡ : íŒ€ë³„ ì‹¤ì ëŸ‰ì— í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤! (ìˆ˜ë¹„ë ¥ ì°¨ì´ ì¡´ì¬)")
else:
    print("âŒ ê²°ë¡ : ëª¨ë“  íŒ€ì˜ ìˆ˜ë¹„ë ¥ì´ ë¹„ìŠ·í•˜ì—¬ ì‹¤ì ëŸ‰ ì°¨ì´ê°€ ìœ ì˜ë¯¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")

# ---------------------------------------------------------
# 3. í•œëˆˆì— ë³´ëŠ” íŒ€ë³„ ë­í‚¹ (Top 5 & Bottom 5)
# ---------------------------------------------------------
print("\nğŸ† ì§€í‘œë³„ ìƒìœ„ íŒ€ í™•ì¸")
ranking = game_team_stats.groupby('team_name_ko').agg({
    'pass_success_rate': 'mean',
    'goals_against': 'mean'
}).sort_values('pass_success_rate', ascending=False)

print("\n[íŒ¨ìŠ¤ ì„±ê³µë¥  TOP 5]")
print(ranking['pass_success_rate'].head())

print("\n[í‰ê·  ì‹¤ì ì´ ê°€ì¥ ì ì€ íŒ€(ìˆ˜ë¹„ ê°•íŒ€) TOP 5]")
print(ranking['goals_against'].sort_values().head())
"""






# [2-3] íŒ€ë³„ í‰ê·  ë“ì  ìˆœìœ„
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\nğŸ† íŒ€ë³„ í‰ê·  ë“ì  ìˆœìœ„:")
# ê·¸ë£¹í™”(groupby)ë¡œ ë¬¶ì–´ì„œ ìš”ì•½ í†µê³„ë¥¼ ë§Œë“¤ ì¤€ë¹„
team_goal_ranking = game_team_stats.groupby('team_name_ko').agg({
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'goals': ['mean', 'std', 'count'],
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'goals_against': 'mean'
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
}).round(2)
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
team_goal_ranking.columns = ['í‰ê· ë“ì ', 'í‘œì¤€í¸ì°¨', 'ê²½ê¸°ìˆ˜', 'í‰ê· ì‹¤ì ']
# ë³€ìˆ˜ `team_goal_ranking`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
team_goal_ranking = team_goal_ranking.sort_values('í‰ê· ë“ì ', ascending=False)

# ë°˜ë³µ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë°˜ë³µë¬¸
for idx, (team, row) in enumerate(team_goal_ranking.iterrows(), 1):
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"  {idx:2d}. {team}: {row['í‰ê· ë“ì ']:.2f}ê³¨ (Â±{row['í‘œì¤€í¸ì°¨']:.2f})")


# [2-4] íŒ¨ìŠ¤ ì„±ê³µë¥ ê³¼ ìŠ¹ë¥  ê°„ ìƒê´€ê´€ê³„ ê²€ì •
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[2-4] ìƒê´€ê´€ê³„ ê²€ì •: íŒ¨ìŠ¤ ì„±ê³µë¥  vs ìŠ¹ë¥ ")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# íŒ€ë³„ íŒ¨ìŠ¤ ì„±ê³µë¥  ë° ìŠ¹ë¥  ê³„ì‚°
# ê·¸ë£¹í™”(groupby)ë¡œ ë¬¶ì–´ì„œ ìš”ì•½ í†µê³„ë¥¼ ë§Œë“¤ ì¤€ë¹„
team_performance = game_team_stats.groupby('team_name_ko').agg({
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'pass_success_rate': 'mean',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'win_or_draw': 'mean'
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
}).round(2)
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
team_performance.columns = ['íŒ¨ìŠ¤ì„±ê³µë¥ ', 'ìŠ¹ë¥ ']
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
team_performance['ìŠ¹ë¥ '] = team_performance['ìŠ¹ë¥ '] * 100

# í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜
# í†µê³„ ê²€ì •/ì§€í‘œ ê³„ì‚° ìˆ˜í–‰
corr_pass_win, p_corr = stats.pearsonr(team_performance['íŒ¨ìŠ¤ì„±ê³µë¥ '], team_performance['ìŠ¹ë¥ '])
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"ìƒê´€ê³„ìˆ˜ (Pearson r): {corr_pass_win:.4f}")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"p-value: {p_corr:.4f}")

# ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ë¶„ê¸°(ì¡°ê±´ë¬¸)
if p_corr < 0.05:
    # ë³€ìˆ˜ `direction`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
    direction = "ì–‘ì˜" if corr_pass_win > 0 else "ìŒì˜"
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"âœ“ ê²°ë¡ : íŒ¨ìŠ¤ ì„±ê³µë¥ ê³¼ ìŠ¹ë¥  ê°„ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ {direction} ìƒê´€ê´€ê³„ê°€ ìˆìŠµë‹ˆë‹¤!")
# ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ë¶„ê¸°(ì¡°ê±´ë¬¸)
else:
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"âœ— ê²°ë¡ : íŒ¨ìŠ¤ ì„±ê³µë¥ ê³¼ ìŠ¹ë¥  ê°„ ìœ ì˜ë¯¸í•œ ìƒê´€ê´€ê³„ê°€ ì—†ìŠµë‹ˆë‹¤.")


# ============================================================
# ğŸ“ˆ [3] ìƒê´€ê´€ê³„ ë¶„ì„ (Correlation Analysis)
# ============================================================
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n" + "="*80)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("[3ë‹¨ê³„] ìƒê´€ê´€ê³„ ë¶„ì„")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("="*80)

# [3-1] ê²½ê¸° í†µê³„ ê°„ ìƒê´€ê´€ê³„ ë§¤íŠ¸ë¦­ìŠ¤
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[3-1] ê²½ê¸° í†µê³„ ê°„ ìƒê´€ê´€ê³„ ë§¤íŠ¸ë¦­ìŠ¤")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# ë³€ìˆ˜ `corr_features`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
corr_features = ['total_passes', 'pass_success_rate', 'total_shots', 
                 # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
                 'goals', 'tackles', 'interceptions', 'fouls', 
                 # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
                 'attack_zone_actions', 'take_ons']

# ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ë³€í™˜ ë° ê²°ì¸¡ì¹˜ ì²˜ë¦¬
# ë°˜ë³µ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë°˜ë³µë¬¸
for col in corr_features:
    # ê²°ì¸¡ì¹˜(NaN)ë¥¼ ì±„ì›Œ ê³„ì‚° ì˜¤ë¥˜ë¥¼ ë°©ì§€
    game_team_stats[col] = pd.to_numeric(game_team_stats[col], errors='coerce').fillna(0)

# ìƒê´€ê´€ê³„ í–‰ë ¬ ê³„ì‚°
# ë³€ìˆ˜ `correlation_matrix`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
correlation_matrix = game_team_stats[corr_features].corr()

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[Pearson ìƒê´€ê´€ê³„ í–‰ë ¬]")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(correlation_matrix.round(2))

# [3-2] ë“ì (goals)ê³¼ ë‹¤ë¥¸ ë³€ìˆ˜ë“¤ ê°„ì˜ ìƒê´€ê´€ê³„
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[3-2] ë“ì (goals)ê³¼ì˜ ìƒê´€ê´€ê³„ ë¶„ì„")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# ë³€ìˆ˜ `goal_correlations`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
goal_correlations = correlation_matrix['goals'].sort_values(ascending=False)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\në“ì ê³¼ì˜ ìƒê´€ê´€ê³„ ìˆœìœ„:")
# ë°˜ë³µ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë°˜ë³µë¬¸
for var, corr in goal_correlations.items():
    # ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ë¶„ê¸°(ì¡°ê±´ë¬¸)
    if var != 'goals':
        # ë³€ìˆ˜ `strength`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
        strength = "ê°•í•¨" if abs(corr) > 0.5 else ("ì¤‘ê°„" if abs(corr) > 0.3 else "ì•½í•¨")
        # ë³€ìˆ˜ `direction`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
        direction = "â†‘" if corr > 0 else "â†“"
        # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
        print(f"  {direction} {var:25s}: {corr:6.3f} ({strength})")

# [3-3] ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ ì‹œê°í™”
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[3-3] ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ ìƒì„± ì¤‘...")

# ì‹œê°í™”(ê·¸ë˜í”„) ê´€ë ¨ ì„¤ì •/ê·¸ë¦¬ê¸°/ì €ì¥
fig, ax = plt.subplots(figsize=(12, 10))
# ì‹œê°í™”(ê·¸ë˜í”„) ê´€ë ¨ ì„¤ì •/ê·¸ë¦¬ê¸°/ì €ì¥
sns.heatmap(correlation_matrix, annot=True, fmt='.2f', cmap='coolwarm', 
            # ë³€ìˆ˜ `center`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
            center=0, square=True, linewidths=1, 
            # ë³€ìˆ˜ `cbar_kws`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
            cbar_kws={"shrink": 0.8}, ax=ax)
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ax.set_title('ê²½ê¸° í†µê³„ ê°„ ìƒê´€ê´€ê³„ ë¶„ì„', fontsize=16, fontweight='bold')
# ì‹œê°í™”(ê·¸ë˜í”„) ê´€ë ¨ ì„¤ì •/ê·¸ë¦¬ê¸°/ì €ì¥
plt.tight_layout()
# ì‹œê°í™”(ê·¸ë˜í”„) ê´€ë ¨ ì„¤ì •/ê·¸ë¦¬ê¸°/ì €ì¥
plt.savefig('reports/figures/reports/figures/correlation_heatmap.png', dpi=300, bbox_inches='tight')
# ì‹œê°í™”(ê·¸ë˜í”„) ê´€ë ¨ ì„¤ì •/ê·¸ë¦¬ê¸°/ì €ì¥
plt.close()
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("âœ“ ì €ì¥ë¨: correlation_heatmap.png")


# ============================================================
# ğŸ¤– [4] ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ë§ (Machine Learning)
# ============================================================
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n" + "="*80)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("[4ë‹¨ê³„] ë¨¸ì‹ ëŸ¬ë‹: ìŠ¹ë¦¬ ì˜ˆì¸¡ ëª¨ë¸")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("="*80)

# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""
ğŸ’¡ ë¨¸ì‹ ëŸ¬ë‹ì´ë€?
   ë°ì´í„°ì˜ íŒ¨í„´ì„ í•™ìŠµí•˜ì—¬ ë¯¸ë˜ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤.
   
   ì˜ˆ) ê³¼ê±° ê²½ê¸°ì˜ íŒ¨ìŠ¤ ì„±ê³µë¥ , ìŠˆíŒ… ìˆ˜, íƒœí´ ìˆ˜ë¥¼ ë³´ê³ 
      â†’ ì´ë²ˆ ê²½ê¸° ìŠ¹ë¦¬ ì—¬ë¶€ë¥¼ ì˜ˆì¸¡

ğŸ“Œ ë¶„ë¥˜ ë¬¸ì œ (Classification):
   - ìŠ¹ë¦¬/ë¬´ìŠ¹ë¶€ (1) vs íŒ¨ë°° (0) ë¥¼ ì˜ˆì¸¡
   - ì´ì§„ ë¶„ë¥˜ ë¬¸ì œì…ë‹ˆë‹¤
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""

# [4-1] ë°ì´í„° ì¤€ë¹„
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[4-1] ë°ì´í„° ì¤€ë¹„")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# ë³€ìˆ˜ `feature_cols`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
feature_cols = [
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'total_passes', 'pass_success_rate', 'total_shots',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'tackles', 'interceptions', 'fouls', 
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'attack_zone_actions', 'take_ons', 'is_home'
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
]

# ê²°ì¸¡ì¹˜(NaN)ë¥¼ ì±„ì›Œ ê³„ì‚° ì˜¤ë¥˜ë¥¼ ë°©ì§€
X = game_team_stats[feature_cols].fillna(0)
# ë³€ìˆ˜ `y`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
y = game_team_stats['win_or_draw']

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"í”¼ì²˜ ìˆ˜: {X.shape[1]}")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"ìƒ˜í”Œ ìˆ˜: {X.shape[0]}")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"ìŠ¹ë¦¬/ë¬´ìŠ¹ë¶€ ë¹„ìœ¨: {y.mean()*100:.1f}%")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"ì‚¬ìš© í”¼ì²˜: {', '.join(feature_cols)}")

# í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë¶„í• 
# í•™ìŠµ/í‰ê°€ ë°ì´í„°ë¡œ ë‚˜ëˆ„ì–´ ëª¨ë¸ ì„±ëŠ¥ì„ ê³µì •í•˜ê²Œ í‰ê°€
X_train, X_test, y_train, y_test = train_test_split(
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    X, y, test_size=0.2, random_state=42, stratify=y
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\ní•™ìŠµ ë°ì´í„°: {X_train.shape[0]}ê°œ, í…ŒìŠ¤íŠ¸ ë°ì´í„°: {X_test.shape[0]}ê°œ")

# í”¼ì²˜ ì •ê·œí™”
# í”¼ì²˜ ìŠ¤ì¼€ì¼ì„ ë§ì¶”ê¸° ìœ„í•´ í‘œì¤€í™”(ìŠ¤ì¼€ì¼ë§) ì ìš©
scaler = StandardScaler()
# í”¼ì²˜ ìŠ¤ì¼€ì¼ì„ ë§ì¶”ê¸° ìœ„í•´ í‘œì¤€í™”(ìŠ¤ì¼€ì¼ë§) ì ìš©
X_train_scaled = scaler.fit_transform(X_train)
# í”¼ì²˜ ìŠ¤ì¼€ì¼ì„ ë§ì¶”ê¸° ìœ„í•´ í‘œì¤€í™”(ìŠ¤ì¼€ì¼ë§) ì ìš©
X_test_scaled = scaler.transform(X_test)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("âœ“ í”¼ì²˜ ì •ê·œí™” ì™„ë£Œ")


# [4-2] ëª¨ë¸ 1: ë¡œì§€ìŠ¤í‹± íšŒê·€
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[4-2] ëª¨ë¸ 1: ë¡œì§€ìŠ¤í‹± íšŒê·€ (Logistic Regression)")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# ë¡œì§€ìŠ¤í‹± íšŒê·€ ëª¨ë¸ ìƒì„±/í•™ìŠµ(ì´ì§„ ë¶„ë¥˜ ê¸°ë³¸ ëª¨ë¸)
lr_model = LogisticRegression(max_iter=1000, random_state=42)
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
lr_model.fit(X_train_scaled, y_train)

# ë³€ìˆ˜ `y_pred_lr`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
y_pred_lr = lr_model.predict(X_test_scaled)
# ë³€ìˆ˜ `y_pred_proba_lr`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
y_pred_proba_lr = lr_model.predict_proba(X_test_scaled)[:, 1]

# ë³€ìˆ˜ `accuracy_lr`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
accuracy_lr = accuracy_score(y_test, y_pred_lr)
# ROC/AUCë¡œ í™•ë¥  ì˜ˆì¸¡ í’ˆì§ˆì„ í‰ê°€
auc_lr = roc_auc_score(y_test, y_pred_proba_lr)

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"âœ“ ëª¨ë¸ í•™ìŠµ ì™„ë£Œ!")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\nğŸ“Š ì„±ëŠ¥ ì§€í‘œ:")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  ì •í™•ë„ (Accuracy): {accuracy_lr:.4f} ({accuracy_lr*100:.1f}%)")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  AUC ì ìˆ˜: {auc_lr:.4f}")

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\nğŸ“‹ ë¶„ë¥˜ ì„±ëŠ¥ ë³´ê³ ì„œ:")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(classification_report(y_test, y_pred_lr, 
                          # ë³€ìˆ˜ `target_names`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
                          target_names=['íŒ¨ë°°', 'ìŠ¹ë¦¬/ë¬´ìŠ¹ë¶€'],
                          # ë³€ìˆ˜ `zero_division`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
                          zero_division=0))

# í”¼ì²˜ ì¤‘ìš”ë„ (ê³„ìˆ˜)
# ë³€ìˆ˜ `feature_importance_lr`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
feature_importance_lr = pd.DataFrame({
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'Feature': feature_cols,
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'Coefficient': lr_model.coef_[0]
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
})
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
feature_importance_lr['Abs_Coefficient'] = np.abs(feature_importance_lr['Coefficient'])
# ë³€ìˆ˜ `feature_importance_lr`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
feature_importance_lr = feature_importance_lr.sort_values('Abs_Coefficient', ascending=False)

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\nğŸ“ˆ í”¼ì²˜ ì¤‘ìš”ë„ (ë¡œì§€ìŠ¤í‹± íšŒê·€):")
# ë°˜ë³µ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë°˜ë³µë¬¸
for idx, row in feature_importance_lr.iterrows():
    # ë³€ìˆ˜ `direction`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
    direction = "â•" if row['Coefficient'] > 0 else "â–"
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"  {direction} {row['Feature']:25s}: {row['Coefficient']:7.4f}")


# [4-3] ëª¨ë¸ 2: ëœë¤í¬ë ˆìŠ¤íŠ¸
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[4-3] ëª¨ë¸ 2: ëœë¤í¬ë ˆìŠ¤íŠ¸ (Random Forest)")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# ëœë¤í¬ë ˆìŠ¤íŠ¸ ëª¨ë¸ ìƒì„±/í•™ìŠµ(ë¹„ì„ í˜• íŒ¨í„´ í•™ìŠµ)
rf_model = RandomForestClassifier(n_estimators=100, max_depth=10, 
                                  # ë³€ìˆ˜ `random_state`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
                                  random_state=42, n_jobs=-1)
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
rf_model.fit(X_train, y_train)

# ë³€ìˆ˜ `y_pred_rf`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
y_pred_rf = rf_model.predict(X_test)
# ë³€ìˆ˜ `y_pred_proba_rf`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
y_pred_proba_rf = rf_model.predict_proba(X_test)[:, 1]

# ë³€ìˆ˜ `accuracy_rf`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
accuracy_rf = accuracy_score(y_test, y_pred_rf)
# ROC/AUCë¡œ í™•ë¥  ì˜ˆì¸¡ í’ˆì§ˆì„ í‰ê°€
auc_rf = roc_auc_score(y_test, y_pred_proba_rf)

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"âœ“ ëª¨ë¸ í•™ìŠµ ì™„ë£Œ!")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\nğŸ“Š ì„±ëŠ¥ ì§€í‘œ:")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  ì •í™•ë„ (Accuracy): {accuracy_rf:.4f} ({accuracy_rf*100:.1f}%)")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  AUC ì ìˆ˜: {auc_rf:.4f}")

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\nğŸ“‹ ë¶„ë¥˜ ì„±ëŠ¥ ë³´ê³ ì„œ:")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(classification_report(y_test, y_pred_rf, 
                          # ë³€ìˆ˜ `target_names`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
                          target_names=['íŒ¨ë°°', 'ìŠ¹ë¦¬/ë¬´ìŠ¹ë¶€'],
                          # ë³€ìˆ˜ `zero_division`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
                          zero_division=0))

# í”¼ì²˜ ì¤‘ìš”ë„
# ë³€ìˆ˜ `feature_importance_rf`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
feature_importance_rf = pd.DataFrame({
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'Feature': feature_cols,
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'Importance': rf_model.feature_importances_
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
}).sort_values('Importance', ascending=False)

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\nğŸ“ˆ í”¼ì²˜ ì¤‘ìš”ë„ (ëœë¤í¬ë ˆìŠ¤íŠ¸):")
# ë°˜ë³µ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë°˜ë³µë¬¸
for idx, row in feature_importance_rf.iterrows():
    # ë³€ìˆ˜ `bar`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
    bar = "â–ˆ" * int(row['Importance'] * 50)
    # ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
    print(f"  {row['Feature']:25s}: {bar} {row['Importance']:.4f}")


# [4-4] ëª¨ë¸ ë¹„êµ
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[4-4] ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# ë³€ìˆ˜ `model_comparison`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
model_comparison = pd.DataFrame({
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'ëª¨ë¸': ['ë¡œì§€ìŠ¤í‹± íšŒê·€', 'ëœë¤í¬ë ˆìŠ¤íŠ¸'],
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'ì •í™•ë„': [accuracy_lr, accuracy_rf],
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'AUC': [auc_lr, auc_rf]
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
})
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(model_comparison.to_string(index=False))

# ë³€ìˆ˜ `best_model_name`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
best_model_name = model_comparison.loc[model_comparison['AUC'].idxmax(), 'ëª¨ë¸']
# ë³€ìˆ˜ `best_auc`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
best_auc = model_comparison['AUC'].max()
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\nâ­ ìµœê³  ì„±ëŠ¥ ëª¨ë¸: {best_model_name} (AUC: {best_auc:.4f})")


# [4-5] êµì°¨ ê²€ì¦
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[4-5] êµì°¨ ê²€ì¦ (5-Fold Cross Validation)")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# ë³€ìˆ˜ `cv_scores_lr`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
cv_scores_lr = cross_val_score(
    # ë¡œì§€ìŠ¤í‹± íšŒê·€ ëª¨ë¸ ìƒì„±/í•™ìŠµ(ì´ì§„ ë¶„ë¥˜ ê¸°ë³¸ ëª¨ë¸)
    LogisticRegression(max_iter=1000, random_state=42),
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    X_train_scaled, y_train, cv=5, scoring='accuracy'
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
)

# ë³€ìˆ˜ `cv_scores_rf`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
cv_scores_rf = cross_val_score(
    # ëœë¤í¬ë ˆìŠ¤íŠ¸ ëª¨ë¸ ìƒì„±/í•™ìŠµ(ë¹„ì„ í˜• íŒ¨í„´ í•™ìŠµ)
    RandomForestClassifier(n_estimators=100, max_depth=10, random_state=42, n_jobs=-1),
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    X_train, y_train, cv=5, scoring='accuracy'
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
)

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"ë¡œì§€ìŠ¤í‹± íšŒê·€:")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  í‰ê·  ì •í™•ë„: {cv_scores_lr.mean():.4f} (Â±{cv_scores_lr.std():.4f})")

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"\nëœë¤í¬ë ˆìŠ¤íŠ¸:")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(f"  í‰ê·  ì •í™•ë„: {cv_scores_rf.mean():.4f} (Â±{cv_scores_rf.std():.4f})")


# ============================================================
# ğŸ’¡ [5] ì¸ì‚¬ì´íŠ¸ ì¶”ì¶œ (Insight Extraction)
# ============================================================
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n" + "="*80)
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("[5ë‹¨ê³„] ì¸ì‚¬ì´íŠ¸ ì¶”ì¶œ ë° ë¶„ì„")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("="*80)

# [5-1] íŒ€ ìˆœìœ„ ë° ì„±ê³¼
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[5-1] íŒ€ ì„±ê³¼ ë¶„ì„ ë° ìµœì¢… ìˆœìœ„")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# ê·¸ë£¹í™”(groupby)ë¡œ ë¬¶ì–´ì„œ ìš”ì•½ í†µê³„ë¥¼ ë§Œë“¤ ì¤€ë¹„
team_stats_full = game_team_stats.groupby('team_name_ko').agg({
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'win_or_draw': ['sum', 'count'],
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'goals': ['sum', 'mean'],
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'goals_against': ['sum', 'mean'],
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'total_passes': 'mean',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'pass_success_rate': 'mean',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'total_shots': 'mean'
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
}).round(2)

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
team_stats_full.columns = ['ìŠ¹/ë¬´', 'ê²½ê¸°ìˆ˜', 'ì´ë“ì ', 'í‰ê· ë“ì ', 
                           # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
                           'ì´ì‹¤ì ', 'í‰ê· ì‹¤ì ', 'í‰ê· íŒ¨ìŠ¤', 'íŒ¨ìŠ¤ì„±ê³µë¥ ', 'í‰ê· ìŠˆíŒ…']

# ìŠ¹ì  ê³„ì‚° (ìŠ¹/ë¬´=1, íŒ¨=0 ì´ë¯€ë¡œ ìŠ¹/ë¬´ ìˆ˜ * 3 + íŒ¨ ìˆ˜ * 0 ë¡œ ë‹¨ìˆœí™”)
# ì—¬ê¸°ì„œëŠ” win_or_drawê°€ ìŠ¹ë¦¬ì™€ ë¬´ìŠ¹ë¶€ë¥¼ í•©ì¹œ ê²ƒì´ë¯€ë¡œ ê·¼ì‚¬ì¹˜
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
team_stats_full['ë“ì‹¤ì°¨'] = team_stats_full['ì´ë“ì '] - team_stats_full['ì´ì‹¤ì ']
# ë³€ìˆ˜ `team_stats_full`ì— ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©)
team_stats_full = team_stats_full.sort_values(['ìŠ¹/ë¬´', 'ë“ì‹¤ì°¨'], ascending=[False, False])

# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\nğŸ† 2024 Kë¦¬ê·¸ íŒ€ ì„±ê³¼ ìˆœìœ„")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print(team_stats_full[['ê²½ê¸°ìˆ˜', 'ìŠ¹/ë¬´', 'ì´ë“ì ', 'ì´ì‹¤ì ', 'ë“ì‹¤ì°¨', 'í‰ê· ë“ì ', 'í‰ê· ì‹¤ì ']].to_string())


# [5-2] íŒ€ë³„ í”Œë ˆì´ ìŠ¤íƒ€ì¼ ë¶„ë¥˜
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("\n[5-2] íŒ€ë³„ í”Œë ˆì´ ìŠ¤íƒ€ì¼ ë¶„ë¥˜")
# ì§„í–‰ ìƒí™©/ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì„œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
print("-"*60)

# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""
ğŸ’¡ íŒ€ ìŠ¤íƒ€ì¼ ë¶„ë¥˜ ê¸°ì¤€:
   - ê³µê²©í˜•: ìŠˆíŒ… ë§ê³  ê³µê²©ì§€ì—­ ì•¡ì…˜ ë§ìŒ
   - ìˆ˜ë¹„í˜•: íƒœí´/ì¸í„°ì…‰ì…˜ ë§ìŒ
   - ì ìœ í˜•: íŒ¨ìŠ¤ ë§ê³  ì„±ê³µë¥  ë†’ìŒ
   - ì˜¬ë¼ìš´ë”: ëª¨ë“  ì§€í‘œê°€ í‰ê·  ì´ìƒ
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""

# ê·¸ë£¹í™”(groupby)ë¡œ ë¬¶ì–´ì„œ ìš”ì•½ í†µê³„ë¥¼ ë§Œë“¤ ì¤€ë¹„
team_style = game_team_stats.groupby('team_name_ko').agg({
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'total_shots': 'mean',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'goals': 'mean',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'tackles': 'mean',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'interceptions': 'mean',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'total_passes': 'mean',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'pass_success_rate': 'mean',
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    'attack_zone_actions': 'mean'
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
}).round(2)

# ì§€í‘œ ì •ê·œí™” (í‰ê·  ëŒ€ë¹„)
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
team_style['attack_index'] = (team_style['total_shots'] / team_style['total_shots'].mean() + 
                              # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
                              team_style['goals'] / team_style['goals'].mean()) / 2
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
team_style['defense_index'] = (team_style['tackles'] / team_style['tackles'].mean() + 
                               # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
                               team_style['interceptions'] / team_style['interceptions'].mean()) / 2
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
team_style['possession_index'] = (team_style['total_passes'] / team_style['total_passes'].mean() + 
                                   # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
                                   team_style['pass_success_rate'] / team_style['pass_success_rate'].mean()) / 2

# ì¬ì‚¬ìš©ì„ ìœ„í•´ í•¨ìˆ˜ë¥¼ ì •ì˜(ë°˜ë³µë˜ëŠ” ë¡œì§ì„ ë¬¶ê¸°)
def classify_style(row):
    # (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
    """íŒ€ ìŠ¤íƒ€ì¼ ë¶„ë¥˜"""
    if row['attack_index'] > 1.1 and row['defense_index'] > 1.1:
        return 'ğŸŒŸ ì˜¬ë¼ìš´ë”'
    elif row['attack_index'] > 1.1:
        return 'âš½ ê³µê²©í˜•'
    elif row['defense_index'] > 1.1:
        return 'ğŸ›¡ï¸ ìˆ˜ë¹„í˜•'
    elif row['possession_index'] > 1.1:
        return 'ğŸ¯ ì ìœ í˜•'
    else:
        return 'âš–ï¸ ê· í˜•í˜•'

team_style['style'] = team_style.apply(classify_style, axis=1)

print("\níŒ€ë³„ í”Œë ˆì´ ìŠ¤íƒ€ì¼:")
for style in ['ğŸŒŸ ì˜¬ë¼ìš´ë”', 'âš½ ê³µê²©í˜•', 'ğŸ›¡ï¸ ìˆ˜ë¹„í˜•', 'ğŸ¯ ì ìœ í˜•', 'âš–ï¸ ê· í˜•í˜•']:
    teams = team_style[team_style['style'] == style].index.tolist()
    if teams:
        print(f"\n{style}:")
        for team in teams:
            row = team_style.loc[team]
            print(f"  â€¢ {team}: ê³µê²©={row['attack_index']:.2f}, ìˆ˜ë¹„={row['defense_index']:.2f}, ì ìœ ={row['possession_index']:.2f}")


# [5-3] í™ˆ ì–´ë“œë°´í‹°ì§€ ë¶„ì„
print("\n[5-3] í™ˆ í•„ë“œ ì–´ë“œë°´í‹°ì§€ ë¶„ì„")
print("-"*60)

home_stats = game_team_stats[game_team_stats['is_home'] == 1]
away_stats = game_team_stats[game_team_stats['is_home'] == 0]

home_win_rate = home_stats['win_or_draw'].mean() * 100
away_win_rate = away_stats['win_or_draw'].mean() * 100

print(f"í™ˆíŒ€ ìŠ¹ë¦¬/ë¬´ìŠ¹ë¶€ìœ¨: {home_win_rate:.1f}%")
print(f"ì–´ì›¨ì´íŒ€ ìŠ¹ë¦¬/ë¬´ìŠ¹ë¶€ìœ¨: {away_win_rate:.1f}%")
print(f"í™ˆ ì–´ë“œë°´í‹°ì§€: {home_win_rate - away_win_rate:.1f}%p")

print(f"\nğŸ“Š í™ˆ vs ì–´ì›¨ì´ ìƒì„¸ ë¹„êµ:")
comparison = pd.DataFrame({
    'í™ˆíŒ€': [home_stats['goals'].mean(), home_stats['total_shots'].mean(), 
             home_stats['pass_success_rate'].mean(), home_stats['tackles'].mean()],
    'ì–´ì›¨ì´íŒ€': [away_stats['goals'].mean(), away_stats['total_shots'].mean(),
               away_stats['pass_success_rate'].mean(), away_stats['tackles'].mean()]
}, index=['í‰ê· ë“ì ', 'í‰ê· ìŠˆíŒ…', 'íŒ¨ìŠ¤ì„±ê³µë¥ ', 'í‰ê· íƒœí´'])
print(comparison.round(2).to_string())


# [5-4] í•µì‹¬ ì¸ì‚¬ì´íŠ¸ ìš”ì•½
print("\n[5-4] í•µì‹¬ ì¸ì‚¬ì´íŠ¸ ìš”ì•½")
print("-"*60)

# ê°€ì¥ ì¤‘ìš”í•œ í”¼ì²˜ ì¶”ì¶œ
top_feature = feature_importance_rf.iloc[0]['Feature']
top_importance = feature_importance_rf.iloc[0]['Importance']

# ê°€ì¥ ë“ì  íš¨ìœ¨ ì¢‹ì€ íŒ€
best_scoring_team = team_goal_ranking.index[0]
best_scoring_avg = team_goal_ranking.iloc[0]['í‰ê· ë“ì ']

# ê°€ì¥ ìˆ˜ë¹„ ì¢‹ì€ íŒ€
best_defense_team = team_goal_ranking.sort_values('í‰ê· ì‹¤ì ').index[0]
best_defense_avg = team_goal_ranking.sort_values('í‰ê· ì‹¤ì ').iloc[0]['í‰ê· ì‹¤ì ']

print(f"""
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ğŸ” í•µì‹¬ ì¸ì‚¬ì´íŠ¸:

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
1ï¸âƒ£ ìŠ¹ë¦¬ ì˜ˆì¸¡ì— ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œ: {top_feature} (ì¤‘ìš”ë„: {top_importance:.3f})

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
2ï¸âƒ£ ìµœë‹¤ ë“ì íŒ€: {best_scoring_team} (í‰ê·  {best_scoring_avg:.2f}ê³¨)

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
3ï¸âƒ£ ìµœì†Œ ì‹¤ì íŒ€: {best_defense_team} (í‰ê·  {best_defense_avg:.2f}ê³¨)

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
4ï¸âƒ£ í™ˆ ì–´ë“œë°´í‹°ì§€: {home_win_rate - away_win_rate:.1f}%p (í™ˆê²½ê¸° ì‹œ ìœ ë¦¬)

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
5ï¸âƒ£ ë¨¸ì‹ ëŸ¬ë‹ ì˜ˆì¸¡ ì •í™•ë„: {max(accuracy_lr, accuracy_rf)*100:.1f}%
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
""")


# ============================================================
# ğŸ“ˆ [6] ì‹œê°í™” ë° ë³´ê³ ì„œ ìƒì„±
# ============================================================
print("\n" + "="*80)
print("[6ë‹¨ê³„] ì‹œê°í™” ë° ë³´ê³ ì„œ ìƒì„±")
print("="*80)

# [6-1] ROC ê³¡ì„ 
print("\n[6-1] ROC ê³¡ì„  ìƒì„± ì¤‘...")
fig, axes = plt.subplots(1, 2, figsize=(14, 5))

# ë¡œì§€ìŠ¤í‹± íšŒê·€ ROC
fpr_lr, tpr_lr, _ = roc_curve(y_test, y_pred_proba_lr)
axes[0].plot(fpr_lr, tpr_lr, label=f'Logistic Regression (AUC={auc_lr:.3f})', linewidth=2, color='blue')
axes[0].plot([0, 1], [0, 1], 'k--', label='Random Classifier')
axes[0].set_xlabel('False Positive Rate')
axes[0].set_ylabel('True Positive Rate')
axes[0].set_title('ROC ê³¡ì„  - ë¡œì§€ìŠ¤í‹± íšŒê·€')
axes[0].legend()
axes[0].grid(True, alpha=0.3)

# ëœë¤í¬ë ˆìŠ¤íŠ¸ ROC
fpr_rf, tpr_rf, _ = roc_curve(y_test, y_pred_proba_rf)
axes[1].plot(fpr_rf, tpr_rf, label=f'Random Forest (AUC={auc_rf:.3f})', linewidth=2, color='orange')
axes[1].plot([0, 1], [0, 1], 'k--', label='Random Classifier')
axes[1].set_xlabel('False Positive Rate')
axes[1].set_ylabel('True Positive Rate')
axes[1].set_title('ROC ê³¡ì„  - ëœë¤í¬ë ˆìŠ¤íŠ¸')
axes[1].legend()
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('reports/figures/reports/figures/ml_roc_curves.png', dpi=300, bbox_inches='tight')
plt.close()
print("âœ“ ì €ì¥ë¨: ml_roc_curves.png")


# [6-2] í”¼ì²˜ ì¤‘ìš”ë„ ë¹„êµ
print("[6-2] í”¼ì²˜ ì¤‘ìš”ë„ ë¹„êµ ì‹œê°í™” ì¤‘...")
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# ë¡œì§€ìŠ¤í‹± íšŒê·€
axes[0].barh(feature_importance_lr['Feature'], feature_importance_lr['Coefficient'], color='steelblue')
axes[0].set_xlabel('ê³„ìˆ˜ê°’')
axes[0].set_title('í”¼ì²˜ ì¤‘ìš”ë„ - ë¡œì§€ìŠ¤í‹± íšŒê·€', fontsize=14)
axes[0].grid(True, alpha=0.3, axis='x')

# ëœë¤í¬ë ˆìŠ¤íŠ¸
axes[1].barh(feature_importance_rf['Feature'], feature_importance_rf['Importance'], color='coral')
axes[1].set_xlabel('ì¤‘ìš”ë„')
axes[1].set_title('í”¼ì²˜ ì¤‘ìš”ë„ - ëœë¤í¬ë ˆìŠ¤íŠ¸', fontsize=14)
axes[1].grid(True, alpha=0.3, axis='x')

plt.tight_layout()
plt.savefig('reports/figures/reports/figures/feature_importance_comparison.png', dpi=300, bbox_inches='tight')
plt.close()
print("âœ“ ì €ì¥ë¨: feature_importance_comparison.png")


# [6-3] íŒ€ ì„±ê³¼ ì¢…í•© ì‹œê°í™”
print("[6-3] íŒ€ ì„±ê³¼ ì¢…í•© ì‹œê°í™” ì¤‘...")
fig, axes = plt.subplots(2, 2, figsize=(16, 12))

# íŒ€ë³„ ë“ì /ì‹¤ì 
ax1 = axes[0, 0]
x_pos = np.arange(len(team_stats_full))
width = 0.35
ax1.bar(x_pos - width/2, team_stats_full['í‰ê· ë“ì '], width, label='í‰ê· ë“ì ', color='steelblue')
ax1.bar(x_pos + width/2, team_stats_full['í‰ê· ì‹¤ì '], width, label='í‰ê· ì‹¤ì ', color='coral')
ax1.set_xticks(x_pos)
ax1.set_xticklabels(team_stats_full.index, rotation=45, ha='right')
ax1.set_ylabel('ê³¨')
ax1.set_title('íŒ€ë³„ í‰ê·  ë“ì /ì‹¤ì ', fontsize=14)
ax1.legend()
ax1.grid(True, alpha=0.3, axis='y')

# íŒ€ ìŠ¤íƒ€ì¼ ì‚°ì ë„
ax2 = axes[0, 1]
scatter = ax2.scatter(team_style['attack_index'], team_style['defense_index'], 
                      s=150, alpha=0.7, c=team_style['possession_index'], cmap='RdYlGn')
for team in team_style.index:
    ax2.annotate(team, (team_style.loc[team, 'attack_index'], 
                        team_style.loc[team, 'defense_index']),
                fontsize=9, ha='center', va='bottom')
ax2.axhline(y=1, color='k', linestyle='--', alpha=0.3)
ax2.axvline(x=1, color='k', linestyle='--', alpha=0.3)
ax2.set_xlabel('ê³µê²© ì§€ìˆ˜')
ax2.set_ylabel('ìˆ˜ë¹„ ì§€ìˆ˜')
ax2.set_title('íŒ€ ìŠ¤íƒ€ì¼ ë¶„ë¥˜ (ê³µê²©/ìˆ˜ë¹„)', fontsize=14)
plt.colorbar(scatter, ax=ax2, label='ì ìœ  ì§€ìˆ˜')

# í™ˆ vs ì–´ì›¨ì´ ë¹„êµ
ax3 = axes[1, 0]
home_away_data = pd.DataFrame({
    'í™ˆíŒ€': [home_stats['goals'].mean(), home_stats['total_shots'].mean(), 
             home_stats['pass_success_rate'].mean()],
    'ì–´ì›¨ì´íŒ€': [away_stats['goals'].mean(), away_stats['total_shots'].mean(),
               away_stats['pass_success_rate'].mean()]
}, index=['í‰ê· ë“ì ', 'í‰ê· ìŠˆíŒ…', 'íŒ¨ìŠ¤ì„±ê³µë¥ '])
home_away_data.plot(kind='bar', ax=ax3, color=['skyblue', 'salmon'])
ax3.set_ylabel('ê°’')
ax3.set_title('í™ˆ vs ì–´ì›¨ì´ ì„±ëŠ¥ ë¹„êµ', fontsize=14)
ax3.tick_params(axis='x', rotation=0)
ax3.grid(True, alpha=0.3, axis='y')
ax3.legend(title='ìœ„ì¹˜')

# í˜¼ë™ í–‰ë ¬ (ëœë¤í¬ë ˆìŠ¤íŠ¸)
ax4 = axes[1, 1]
cm = confusion_matrix(y_test, y_pred_rf)
sns.heatmap(cm, annot=True, fmt='d', cmap='Blues', ax=ax4,
            xticklabels=['íŒ¨ë°°', 'ìŠ¹ë¦¬/ë¬´ìŠ¹ë¶€'], yticklabels=['íŒ¨ë°°', 'ìŠ¹ë¦¬/ë¬´ìŠ¹ë¶€'])
ax4.set_xlabel('ì˜ˆì¸¡')
ax4.set_ylabel('ì‹¤ì œ')
ax4.set_title('í˜¼ë™ í–‰ë ¬ (ëœë¤í¬ë ˆìŠ¤íŠ¸)', fontsize=14)

plt.tight_layout()
plt.savefig('reports/figures/reports/figures/team_performance_analysis.png', dpi=300, bbox_inches='tight')
plt.close()
print("âœ“ ì €ì¥ë¨: team_performance_analysis.png")


# [6-4] ë¶„í¬ ë¶„ì„ ì‹œê°í™”
print("[6-4] ë¶„í¬ ë¶„ì„ ì‹œê°í™” ì¤‘...")
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

for ax, col, color, title in zip(
    axes.flat,
    ['goals', 'total_shots', 'pass_success_rate', 'tackles'],
    ['steelblue', 'coral', 'green', 'purple'],
    ['ë“ì  ë¶„í¬', 'ìŠˆíŒ… ìˆ˜ ë¶„í¬', 'íŒ¨ìŠ¤ ì„±ê³µë¥  ë¶„í¬', 'íƒœí´ ìˆ˜ ë¶„í¬']
):
    ax.hist(game_team_stats[col], bins=20, color=color, edgecolor='black', alpha=0.7)
    ax.axvline(game_team_stats[col].mean(), color='red', linestyle='--', linewidth=2, label='í‰ê· ')
    ax.set_xlabel(col)
    ax.set_ylabel('ë¹ˆë„')
    ax.set_title(title, fontsize=14)
    ax.legend()
    ax.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('reports/figures/reports/figures/distribution_analysis.png', dpi=300, bbox_inches='tight')
plt.close()
print("âœ“ ì €ì¥ë¨: distribution_analysis.png")


# ============================================================
# ğŸ“„ [7] ìµœì¢… ë³´ê³ ì„œ ìƒì„±
# ============================================================
print("\n[7ë‹¨ê³„] ìµœì¢… ë³´ê³ ì„œ ìƒì„±")
print("-"*80)

report = f"""
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â•‘                   2024 Kë¦¬ê·¸ ê³ ê¸‰ ë¶„ì„ ìµœì¢… ë³´ê³ ì„œ                             â•‘
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â•‘                   Part 2: í†µê³„ë¶„ì„ ~ ë¨¸ì‹ ëŸ¬ë‹ ~ ì¸ì‚¬ì´íŠ¸                       â•‘
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ã€ 1. ë¶„ì„ ê°œìš” ã€‘
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ì´ ê²½ê¸° ìˆ˜: {game_team_stats['game_id'].nunique()}ê²½ê¸°
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ë¶„ì„ íŒ€: {game_team_stats['team_name_ko'].nunique()}ê°œ íŒ€
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ì´ ë°ì´í„° í¬ì¸íŠ¸: {len(game_team_stats)}ê°œ (ê²½ê¸°-íŒ€ë³„)


# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ã€ 2. í†µê³„ ê²€ì • ê²°ê³¼ ã€‘
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
2-1) í™ˆ/ì–´ì›¨ì´ ë“ì  ì°¨ì´ (t-ê²€ì •)
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ í™ˆíŒ€ í‰ê·  ë“ì : {home_goals.mean():.2f}ê³¨
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ ì–´ì›¨ì´íŒ€ í‰ê·  ë“ì : {away_goals.mean():.2f}ê³¨
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ t-í†µê³„ëŸ‰: {t_stat:.4f}
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ p-value: {p_ttest:.4f}
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ ê²°ë¡ : {'âœ“ ìœ ì˜ë¯¸í•œ ì°¨ì´ ìˆìŒ' if p_ttest < 0.05 else 'âœ— ìœ ì˜ë¯¸í•œ ì°¨ì´ ì—†ìŒ'}

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
2-2) íŒ€ë³„ ë“ì  ì°¨ì´ (ANOVA)
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ F-í†µê³„ëŸ‰: {f_stat:.4f}
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ p-value: {p_anova:.4f}
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ ê²°ë¡ : {'âœ“ íŒ€ë³„ ìœ ì˜ë¯¸í•œ ì°¨ì´ ìˆìŒ' if p_anova < 0.05 else 'âœ— íŒ€ë³„ ì°¨ì´ ì—†ìŒ'}

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
2-3) íŒ¨ìŠ¤ ì„±ê³µë¥  â†” ìŠ¹ë¥  ìƒê´€ê´€ê³„
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ Pearson r: {corr_pass_win:.4f}
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ p-value: {p_corr:.4f}
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ ê²°ë¡ : {'âœ“ ìœ ì˜ë¯¸í•œ ìƒê´€ê´€ê³„' if p_corr < 0.05 else 'âœ— ìƒê´€ê´€ê³„ ì—†ìŒ'}


# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ã€ 3. ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ì„±ê³¼ ã€‘
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
3-1) ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”‚ ëª¨ë¸             â”‚ ì •í™•ë„(%)    â”‚ AUC ì ìˆ˜   â”‚
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”‚ ë¡œì§€ìŠ¤í‹± íšŒê·€    â”‚ {accuracy_lr*100:6.2f}%     â”‚ {auc_lr:.4f}     â”‚
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”‚ ëœë¤í¬ë ˆìŠ¤íŠ¸     â”‚ {accuracy_rf*100:6.2f}%     â”‚ {auc_rf:.4f}     â”‚
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
3-2) ìµœê³  ì„±ëŠ¥ ëª¨ë¸: {best_model_name}
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ AUC: {best_auc:.4f}
    # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
    â€¢ êµì°¨ ê²€ì¦ ì •í™•ë„: {(cv_scores_lr.mean() if auc_lr > auc_rf else cv_scores_rf.mean()):.4f}

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
3-3) í•µì‹¬ í”¼ì²˜ (Top 5)
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""

for i, (idx, row) in enumerate(feature_importance_rf.head(5).iterrows(), 1):
    report += f"    {i}. {row['Feature']}: {row['Importance']:.4f}\n"

report += f"""

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ã€ 4. íŒ€ë³„ ìŠ¤íƒ€ì¼ ë¶„ë¥˜ ã€‘
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""

for style in ['ğŸŒŸ ì˜¬ë¼ìš´ë”', 'âš½ ê³µê²©í˜•', 'ğŸ›¡ï¸ ìˆ˜ë¹„í˜•', 'ğŸ¯ ì ìœ í˜•', 'âš–ï¸ ê· í˜•í˜•']:
    teams = team_style[team_style['style'] == style].index.tolist()
    if teams:
        report += f"\n{style}: {', '.join(teams)}"

report += f"""


# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ã€ 5. í•µì‹¬ ì¸ì‚¬ì´íŠ¸ ã€‘
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
âœ“ ì™„ì„±ëœ ë¶„ì„:
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  â€¢ ê°€ì„¤ê²€ì • (t-ê²€ì •, ANOVA)
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  â€¢ ìƒê´€ê´€ê³„ ë¶„ì„ (Pearson)
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  â€¢ ë¨¸ì‹ ëŸ¬ë‹ ì˜ˆì¸¡ ëª¨ë¸ (ì •í™•ë„ {max(accuracy_lr, accuracy_rf)*100:.1f}%)
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  â€¢ íŒ€ë³„ ìŠ¤íƒ€ì¼ ë¶„ë¥˜
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  â€¢ í™ˆ/ì–´ì›¨ì´ ì´ì  ë¶„ì„

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ğŸ’¡ ë°ì´í„° ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸:
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  1. ìŠ¹ë¦¬ ì˜ˆì¸¡ì— ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œ: {top_feature}
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  2. ìµœë‹¤ ë“ì íŒ€: {best_scoring_team} (í‰ê·  {best_scoring_avg:.2f}ê³¨)
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  3. ìµœì†Œ ì‹¤ì íŒ€: {best_defense_team} (í‰ê·  {best_defense_avg:.2f}ê³¨)
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  4. í™ˆ ì–´ë“œë°´í‹°ì§€: {home_win_rate - away_win_rate:.1f}%p


# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ã€ 6. ìƒì„±ëœ íŒŒì¼ ëª©ë¡ ã€‘
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  ğŸ“ˆ ì‹œê°í™”:
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ correlation_heatmap.png - ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ
     # ROC/AUCë¡œ í™•ë¥  ì˜ˆì¸¡ í’ˆì§ˆì„ í‰ê°€
     â€¢ ml_roc_curves.png - ROC ê³¡ì„  ë¹„êµ
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ feature_importance_comparison.png - í”¼ì²˜ ì¤‘ìš”ë„ ë¹„êµ
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ team_performance_analysis.png - íŒ€ ì„±ê³¼ ì¢…í•©
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ distribution_analysis.png - ë°ì´í„° ë¶„í¬
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  ğŸ“„ ë³´ê³ ì„œ:
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ reports/docs/final_analysis_report.txt - ì´ ë³´ê³ ì„œ
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  ğŸ“Š ë°ì´í„°:
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ team_ranking.csv - íŒ€ ìˆœìœ„
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ feature_importance.csv - í”¼ì²˜ ì¤‘ìš”ë„

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
                           ë¶„ì„ ì™„ë£Œ | 2024 Kë¦¬ê·¸ ì‹œì¦Œ
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
"""

print(report)

# ë³´ê³ ì„œ ì €ì¥
with open('reports/docs/final_analysis_report.txt', 'w', encoding='utf-8') as f:
    f.write(report)
print("âœ“ ë¶„ì„ ë³´ê³ ì„œ ì €ì¥: reports/docs/final_analysis_report.txt")

# íŒ€ ìˆœìœ„ ì €ì¥
team_stats_full.to_csv('team_ranking.csv', encoding='utf-8')
print("âœ“ íŒ€ ìˆœìœ„ ì €ì¥: team_ranking.csv")

# í”¼ì²˜ ì¤‘ìš”ë„ ì €ì¥
feature_importance_rf.to_csv('feature_importance.csv', index=False, encoding='utf-8')
print("âœ“ í”¼ì²˜ ì¤‘ìš”ë„ ì €ì¥: feature_importance.csv")


# ============================================================
# ğŸ‰ ìµœì¢… ê²°ê³¼
# ============================================================
print("\n" + "="*80)
print("âœ“âœ“âœ“ ëª¨ë“  ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! âœ“âœ“âœ“")
print("="*80)

print(f"""
# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ğŸ“Š ìƒì„±ëœ ê²°ê³¼ë¬¼ ìš”ì•½:
  
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  ğŸ“ˆ ì‹œê°í™” (5ê°œ):
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ correlation_heatmap.png
     # ROC/AUCë¡œ í™•ë¥  ì˜ˆì¸¡ í’ˆì§ˆì„ í‰ê°€
     â€¢ ml_roc_curves.png
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ feature_importance_comparison.png
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ team_performance_analysis.png
     # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
     â€¢ distribution_analysis.png
     
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  ğŸ“„ ë³´ê³ ì„œ: reports/docs/final_analysis_report.txt
  
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  ğŸ“Š ë°ì´í„°: team_ranking.csv, feature_importance.csv

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ğŸ“ í•™ìŠµ í¬ì¸íŠ¸:
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  1. í†µê³„ë¶„ì„: t-ê²€ì •, ANOVA, ìƒê´€ê´€ê³„ ë¶„ì„
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  2. ë¨¸ì‹ ëŸ¬ë‹: ë¡œì§€ìŠ¤í‹± íšŒê·€, ëœë¤í¬ë ˆìŠ¤íŠ¸
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  3. ëª¨ë¸ í‰ê°€: ì •í™•ë„, AUC, êµì°¨ ê²€ì¦
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  4. ì¸ì‚¬ì´íŠ¸ ì¶”ì¶œ: íŒ€ ìŠ¤íƒ€ì¼, í™ˆ ì–´ë“œë°´í‹°ì§€
  # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
  5. ì‹œê°í™”: matplotlib, seaborn í™œìš©

# ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
ğŸš€ ì‹¤í–‰ ë°©ë²•:
   # ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ì‹¤í–‰ ì½”ë“œ(íë¦„ì„ ë”°ë¼ ì½ê¸°)
   python k_league_advanced_analysis.py
# (ë¬¸ì„œ ë¬¸ìì—´) ì„¤ëª…/ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ë¸”ë¡
""")

print("="*80)
print("ë¶„ì„ ì™„ë£Œ! ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! ğŸ‰")
print("="*80 + "\n")
